/* ===========================================================
 * bootstrap-simple_upload.js j2
 * http://jasny.github.com/bootstrap/javascript.html#simple_upload
 * ===========================================================
 * Copyright 2012 Jasny BV, Netherlands.
 *
 * Licensed under the Apache License, Version 2.0 (the "License")
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.type=this.$element.data("uploadtype")||(this.$element.find(".thumbnail").length>0?"image":"file");this.$input=this.$element.find(":file");if(this.$input.length===0)return;this.name=this.$input.attr("name")||n.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]');if(this.$hidden.length===0){this.$hidden=e('<input type="hidden" />');this.$element.prepend(this.$hidden)}this.$preview=this.$element.find(".simple_upload-preview");var r=this.$preview.css("height");this.$preview.css("display")!="inline"&&r!="0px"&&r!="none"&&this.$preview.css("line-height",r);this.original={exists:this.$element.hasClass("simple_upload-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.$remove=this.$element.find('[data-dismiss="simple_upload"]');this.$element.find('[data-trigger="simple_upload"]').on("click.simple_upload",e.proxy(this.trigger,this));this.listen()};t.prototype={listen:function(){this.$input.on("change.simple_upload",e.proxy(this.change,this));e(this.$input[0].form).on("reset.simple_upload",e.proxy(this.reset,this));this.$remove&&this.$remove.on("click.simple_upload",e.proxy(this.clear,this))},change:function(e,t){if(t==="clear")return;var n=e.target.files!==undefined?e.target.files[0]:e.target.value?{name:e.target.value.replace(/^.+\\/,"")}:null;if(!n){this.clear();return}this.$hidden.val("");this.$hidden.attr("name","");this.$input.attr("name",this.name);if(this.type==="image"&&this.$preview.length>0&&(typeof n.type!="undefined"?n.type.match("image.*"):n.name.match("\\.(gif|png|jpe?g)$"))&&typeof FileReader!="undefined"){var r=new FileReader,i=this.$preview,s=this.$element;r.onload=function(e){i.html('<img src="'+e.target.result+'" '+(i.css("max-height")!="none"?'style="max-height: '+i.css("max-height")+';"':"")+" />");s.addClass("simple_upload-exists").removeClass("simple_upload-new")};r.readAsDataURL(n)}else{this.$preview.text(n.name);this.$element.addClass("simple_upload-exists").removeClass("simple_upload-new")}},clear:function(e){this.$hidden.val("");this.$hidden.attr("name",this.name);this.$input.attr("name","");if(navigator.userAgent.match(/msie/i)){var t=this.$input.clone(!0);this.$input.after(t);this.$input.remove();this.$input=t}else this.$input.val("");this.$preview.html("");this.$element.addClass("simple_upload-new").removeClass("simple_upload-exists");if(e){this.$input.trigger("change",["clear"]);e.preventDefault()}},reset:function(e){this.clear();this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);this.original.exists?this.$element.addClass("simple_upload-exists").removeClass("simple_upload-new"):this.$element.addClass("simple_upload-new").removeClass("simple_upload-exists")},trigger:function(e){this.$input.trigger("click");e.preventDefault()}};e.fn.simple_upload=function(n){return this.each(function(){var r=e(this),i=r.data("simple_upload");i||r.data("simple_upload",i=new t(this,n));typeof n=="string"&&i[n]()})};e.fn.simple_upload.Constructor=t;e(document).on("click.simple_upload.data-api",'[data-provides="simple_upload"]',function(t){var n=e(this);if(n.data("simple_upload"))return;n.simple_upload(n.data());var r=e(t.target).closest('[data-dismiss="simple_upload"],[data-trigger="simple_upload"]');if(r.length>0){r.trigger("click.simple_upload");t.preventDefault()}})}(window.jQuery);